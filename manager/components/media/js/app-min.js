/**
 * @license RequireJS text 2.0.12 Copyright (c) 2010-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/text for details
 */

/**
 * @license RequireJS domReady 2.0.1 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/domReady for details
 */

define("text",["module"],function(e){var t,n,r,i,s,o=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],u=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,a=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,f=typeof location!="undefined"&&location.href,l=f&&location.protocol&&location.protocol.replace(/\:/,""),c=f&&location.hostname,h=f&&(location.port||undefined),p={},d=e.config&&e.config()||{};t={version:"2.0.12",strip:function(e){if(e){e=e.replace(u,"");var t=e.match(a);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:d.createXhr||function(){var e,t,n;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;if(typeof ActiveXObject!="undefined")for(t=0;t<3;t+=1){n=o[t];try{e=new ActiveXObject(n)}catch(r){}if(e){o=[n];break}}return e},parseName:function(e){var t,n,r,i=!1,s=e.indexOf("."),o=e.indexOf("./")===0||e.indexOf("../")===0;return s!==-1&&(!o||s>1)?(t=e.substring(0,s),n=e.substring(s+1,e.length)):t=e,r=n||t,s=r.indexOf("!"),s!==-1&&(i=r.substring(s+1)==="strip",r=r.substring(0,s),n?n=r:t=r),{moduleName:t,ext:n,strip:i}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,r,i){var s,o,u,a=t.xdRegExp.exec(e);return a?(s=a[2],o=a[3],o=o.split(":"),u=o[1],o=o[0],(!s||s===n)&&(!o||o.toLowerCase()===r.toLowerCase())&&(!u&&!o||u===i)):!0},finishLoad:function(e,n,r,i){r=n?t.strip(r):r,d.isBuild&&(p[e]=r),i(r)},load:function(e,n,r,i){if(i&&i.isBuild&&!i.inlineText){r();return}d.isBuild=i&&i.isBuild;var s=t.parseName(e),o=s.moduleName+(s.ext?"."+s.ext:""),u=n.toUrl(o),a=d.useXhr||t.useXhr;if(u.indexOf("empty:")===0){r();return}!f||a(u,l,c,h)?t.get(u,function(n){t.finishLoad(e,s.strip,n,r)},function(e){r.error&&r.error(e)}):n([o],function(e){t.finishLoad(s.moduleName+"."+s.ext,s.strip,e,r)})},write:function(e,n,r,i){if(p.hasOwnProperty(n)){var s=t.jsEscape(p[n]);r.asModule(e+"!"+n,"define(function () { return '"+s+"';});\n")}},writeFile:function(e,n,r,i,s){var o=t.parseName(n),u=o.ext?"."+o.ext:"",a=o.moduleName+u,f=r.toUrl(o.moduleName+u)+".js";t.load(a,r,function(n){var r=function(e){return i(f,e)};r.asModule=function(e,t){return i.asModule(e,f,t)},t.write(e,a,r,s)},s)}};if(d.env==="node"||!d.env&&typeof process!="undefined"&&process.versions&&!!process.versions.node&&!process.versions["node-webkit"])n=require.nodeRequire("fs"),t.get=function(e,t,r){try{var i=n.readFileSync(e,"utf8");i.indexOf("ï»¿")===0&&(i=i.substring(1)),t(i)}catch(s){r&&r(s)}};else if(d.env==="xhr"||!d.env&&t.createXhr())t.get=function(e,n,r,i){var s=t.createXhr(),o;s.open("GET",e,!0);if(i)for(o in i)i.hasOwnProperty(o)&&s.setRequestHeader(o.toLowerCase(),i[o]);d.onXhr&&d.onXhr(s,e),s.onreadystatechange=function(t){var i,o;s.readyState===4&&(i=s.status||0,i>399&&i<600?(o=new Error(e+" HTTP status: "+i),o.xhr=s,r&&r(o)):n(s.responseText),d.onXhrComplete&&d.onXhrComplete(s,e))},s.send(null)};else if(d.env==="rhino"||!d.env&&typeof Packages!="undefined"&&typeof java!="undefined")t.get=function(e,t){var n,r,i="utf-8",s=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),u=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(s),i)),a="";try{n=new java.lang.StringBuffer,r=u.readLine(),r&&r.length()&&r.charAt(0)===65279&&(r=r.substring(1)),r!==null&&n.append(r);while((r=u.readLine())!==null)n.append(o),n.append(r);a=String(n.toString())}finally{u.close()}t(a)};else if(d.env==="xpconnect"||!d.env&&typeof Components!="undefined"&&Components.classes&&Components.interfaces)r=Components.classes,i=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),s="@mozilla.org/windows-registry-key;1"in r,t.get=function(e,t){var n,o,u,a={};s&&(e=e.replace(/\//g,"\\")),u=new FileUtils.File(e);try{n=r["@mozilla.org/network/file-input-stream;1"].createInstance(i.nsIFileInputStream),n.init(u,1,0,!1),o=r["@mozilla.org/intl/converter-input-stream;1"].createInstance(i.nsIConverterInputStream),o.init(n,"utf-8",n.available(),i.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),o.readString(n.available(),a),o.close(),n.close(),t(a.value)}catch(f){throw new Error((u&&u.path||"")+": "+f)}};return t}),define("text!tpl/list.html",[],function(){return'<tpl for="rows">\r\n    <dl class="record">\r\n        <tpl for="parent.columns">\r\n            <dt style="width: {[values.width * 100]}%; text-align: {align};">\r\n                <em unselectable="on"<tpl if="cls"> class="{cls}</tpl>">\r\n                {[values.tpl.apply(parent)]}\r\n                </em>\r\n            </dt>\r\n        </tpl>\r\n        <div class="x-clear"></div>\r\n    </dl>\r\n</tpl>\r\n'}),define("utils/version",[],function(){Ext.apply(MODx,{version_compare:function(e,t,n){this.php_js=this.php_js||{},this.php_js.ENV=this.php_js.ENV||{};var r=0,i=0,s=0,o={dev:-6,alpha:-5,a:-5,beta:-4,b:-4,RC:-3,rc:-3,"#":-2,p:1,pl:1},u=function(e){return e=(""+e).replace(/[_\-+]/g,"."),e=e.replace(/([^.\d]+)/g,".$1.").replace(/\.{2,}/g,"."),e.length?e.split("."):[-8]};numVersion=function(e){return e?isNaN(e)?o[e]||-7:parseInt(e,10):0},e=u(e),t=u(t),i=Math.max(e.length,t.length);for(r=0;r<i;r++){if(e[r]==t[r])continue;e[r]=numVersion(e[r]),t[r]=numVersion(t[r]);if(e[r]<t[r]){s=-1;break}if(e[r]>t[r]){s=1;break}}if(!n)return s;switch(n){case">":case"gt":return s>0;case">=":case"ge":return s>=0;case"<=":case"le":return s<=0;case"==":case"=":case"eq":return s===0;case"<>":case"!=":case"ne":return s!==0;case"":case"<":case"lt":return s<0;default:return null}},isRevo:function(e,t){return this.version_compare(MODx.config.version,t,e)}})}),define("browser/Store",["utils/version"],function(){var e=Ext.state.Manager.get("media-view-store",{source:MODx.config.default_media_source,dir:""});Ext.apply(e,{action:(MODx.isRevo(">=","2.3.0-dev")?"browser/directory/":"")+"getFiles"});var t=new Ext.data.JsonStore({url:MODx.isRevo(">=","2.3.0-dev")?MODx.config.connector_url:MODx.config.connectors_url+"browser/directory.php",baseParams:e,root:"results",totalProperty:"total",fields:["id","name","description","thumb","size","selected"]});return t.load(),t.on("load",function(){var e=t.lastOptions||{};e.params&&(e=e.params,Ext.state.Manager.set("media-view-store",{source:e.source,dir:e.dir}))}),t}),define("text!tpl/preview.html",[],function(){return'<div class="x-clear"></div>\r\n<div class="preview expander">\r\n    <div class="main">\r\n        <a class="close" href="javascript:;"><i class="icon icon-times"></i></a>\r\n\r\n        <div class="summary">\r\n            <img src="{thumb}" />\r\n            <dl>\r\n                <dt>Type :&nbsp;</dt>\r\n                <dd>Image</dd>\r\n                <dt>Source :&nbsp;</dt>\r\n                <dd>Assets</dd>\r\n                <dt>Caption :&nbsp;</dt>\r\n                <dd>{name}</dd>\r\n                <dt>Size :&nbsp;</dt>\r\n                <dd>{size}</dd>\r\n            </dl>\r\n        </div>\r\n\r\n        <div class="meta">\r\n            <div class="section">\r\n                <h3>Tags</h3>\r\n            </div>\r\n\r\n            <div class="section">\r\n                <h3>Meta</h3>\r\n            </div>\r\n\r\n            <div class="section">\r\n                <h3>Transforms</h3>\r\n            </div>\r\n\r\n            <div class="section">\r\n                <h3>Usage</h3>\r\n            </div>\r\n        </div>\r\n\r\n        <div class="x-clear"></div>\r\n    </div>\r\n\r\n    <div class="bottom-actions">\r\n        <ul>\r\n            <li>\r\n                <a href="javascript:;">Move to</a> <i class="icon icon-gear"></i>\r\n            </li>\r\n            <li>\r\n                <a href="javascript:;">Replace</a> <i class="icon icon-gear"></i>\r\n            </li>\r\n            <li>\r\n                <a href="javascript:;">Delete</a> <i class="icon icon-gear"></i>\r\n            </li>\r\n        </ul>\r\n    </div>\r\n</div>\r\n'}),define("browser/Update",[],function(){Ext.ns("Media.window"),Media.window.CreateCmpItem=function(e){e=e||{},Ext.applyIf(e,{title:_("media.cmpitem_create"),url:Media.config.connector_url,closeAction:"close",baseParams:{action:"cmpitem/create"},fields:[{xtype:"hidden",name:"id"},{xtype:"textfield",fieldLabel:_("media.name"),name:"name",anchor:"100%"},{xtype:"textarea",fieldLabel:_("media.description"),name:"description",anchor:"100%"}]}),Media.window.CreateCmpItem.superclass.constructor.call(this,e)},Ext.extend(Media.window.CreateCmpItem,MODx.Window),Ext.reg("media-window-cmpitem-create",Media.window.CreateCmpItem),Media.window.UpdateCmpItem=function(e){e=e||{},Ext.applyIf(e,{title:_("media.cmpitem_update"),baseParams:{action:"cmpitem/update"}}),Media.window.UpdateCmpItem.superclass.constructor.call(this,e)},Ext.extend(Media.window.UpdateCmpItem,Media.window.CreateCmpItem),Ext.reg("media-window-cmpitem-update",Media.window.UpdateCmpItem)}),define("text!tpl/uploader.html",[],function(){return'<div class="uploader">\r\n    <h3>Upload in progress</h3>\r\n    <tpl if="files && files.length &gt; 0">\r\n        <ul>\r\n            <tpl for="files">\r\n                <li class="upload-record">\r\n                    <span class="filename">{name}</span>\r\n                    <span class="fileprogress">\r\n                        <span class="progress" style="width: {[Math.floor((Math.random() * 100) + 1)]}%"></span>\r\n                    </span>\r\n                    <span class="fileactions">actions</span>\r\n                </li>\r\n            </tpl>\r\n        </ul>\r\n    </tpl>\r\n</div>\r\n'}),define("browser/upload",["text!tpl/uploader.html"],function(e){return Ext.ux.UploadPlugin=function(e){e=e||{},Ext.applyIf(e,{component:null,dz:null,listenerTry:0}),Ext.ux.UploadPlugin.superclass.constructor.call(this,e)},Ext.extend(Ext.ux.UploadPlugin,Ext.util.Observable,{init:function(e){this.listenerTry=0,console.info("Plugin init",e),this.component=e,this.addContainerEvents(),this.component.getUploader=this.getUploader.createDelegate(this),this.component.on("render",this.setDropZone,this),this.storeHasListener()||this.component.store.on("load",function(){this.setDropZone()},this)},addContainerEvents:function(){this.component.addEvents("beforeShowDropZone"),this.component.on("beforeShowDropZone",function(){console.log("on before show drop zone");var e=this.component.el.query("div.preview");e.length===1&&this.component.fadeAndDestroy(Ext.get(e[0]))},this)},storeHasListener:function(){var e=this.component.store;if(e.hasListener("load")){var t=e.events.load.listeners;Ext.each(t,function(e,n){if(e&&e.scope&&e.scope instanceof Ext.ux.UploadPlugin)return console.info("Previous listener already set to store",n,"removing it"),t.splice(n,1),!0})}return!1},getUploader:function(){return this},setDropZone:function(){Ext.defer(function(){var e=this.component,t=e.getEl(),n=t.query(".dropzone");if(n.length>0)return console.info("Dropzone already found, skipping"),this.dz=Ext.get(n[0]),!1;console.info("Adding dropzone, source %o, el %o",e,t);var r=t.query(e.itemSelector+":last-of-type"),i=Ext.get(r[0]),s='<div class="dropzone">Drop files</div>',o=(new Ext.XTemplate(s)).apply();if(!i)return this.listenerTry<2?(this.listenerTry+=1,console.log("No last node found, scheduling again",this.listenerTry),this.setDropZone()):(console.error("Too much tries : ",this,this.listenerTry),!1);this.listenerTry=0,console.info("last record node",i),this.dz=Ext.DomHelper.insertAfter(i,o,!0),this.hideDropZone(),this.setListeners()},250,this)},setListeners:function(){var e=this.component.getEl(),t=this.dz;this.relayEvents(t,["dragleave","dragover","drop","mouseleave"]),e.on("dragenter",this.onDragEnter,this,{stopEvent:!0}),this.on({dragleave:this.onDragLeave,dragover:this.onDragOver,drop:this.onDrop,mouseleave:this.hideDropZone,scope:this})},onDragEnter:function(e,t,n){return e.stopPropagation(),e.preventDefault(),console.log("onDragEnter: dz %o, elem %o",this.dz,t),this.showDropZone(),!1},onDragOver:function(e){return e.stopPropagation(),e.preventDefault(),!1},onDragLeave:function(e,t,n){e.stopPropagation(),e.preventDefault(),console.log("onDragLeave",t),this.hideDropZone()},onDrop:function(t,n,r){t=window.event,t.stopPropagation(),t.preventDefault(),console.log("onDrop",t,n);var i=[],s=t.target.files||t.dataTransfer.files;(!s||s.length<1)&&this.hideDropZone(),Ext.each(s,function(e){console.log("file",e),i.push(e)});var o=(new Ext.XTemplate(e)).apply({files:i});this.dz.update(o)},hideDropZone:function(){this.dz.hide(),this.resetDropZone()},resetDropZone:function(){this.dz.update("Drop files")},showDropZone:function(){this.component.fireEvent("beforeShowDropZone",this.dz,this)!==!1&&this.dz.show()}}),Ext.preg("upload",Ext.ux.UploadPlugin),Ext.ux.UploadPlugin}),define("browser/shared",["text!tpl/preview.html","browser/Update","browser/upload"],function(e,t,n){var r={previewSelector:"div.preview",getPreview:function(t,n){return(new Ext.XTemplate(e,{compiled:!0,disableFormats:!0})).apply(t.json)},displayPreview:function(e,t){t||(t=e.event,e=e.node);var n=Ext.get(e).down(this.previewSelector);if(n)return this.fadeAndDestroy(n);var r=this.getRecord(e);this.beforeShowPreview(e,t,r);var i=this.getPreview(r,t);this.previewToDOM(e,i),this.afterPreviewRendered(e,r)},fadeAndDestroy:function(e){e.animate({opacity:{to:0,from:1}},"",function(){e.remove()})},previewToDOM:function(e,t){Ext.DomHelper.append(e,t);var n=Ext.get(e).down(this.previewSelector);this.animatePreview(n)},afterPreviewRendered:function(e,t){},animatePreview:function(e){var t=e.child("a.close");t.on("click",function(t,n){this.fadeAndDestroy(e);var r=e.up("li.record");r&&r.child(".inline-actions").addClass("x-hidden")},this),e.animate({opacity:{to:1,from:0}})},beforeShowPreview:function(e,t,n){Ext.each(this.el.query("div.preview"),function(e,t,n){e.parentNode.removeChild(e)})},toggleSelection:function(e){var t=this.getNode(e),n=this.getRecord(t);this.getSelectedIndexes().indexOf(e)!=-1?(this.deselect(e),n.set("selected",!1)):(this.select(e,!0),n.set("selected",!0))},navigateTo:function(e,t,n,r){console.log("navigate!",t)},createRecord:function(e,t){this.CmpItemWindow=MODx.load({xtype:"media-window-cmpitem-create",listeners:{success:{fn:this.refreshStore,scope:this}}}),this.CmpItemWindow.show(t.target)},updateRecord:function(e,t){t||(t=e.event,e=e.record.json),this.CmpItemWindow=MODx.load({xtype:"media-window-cmpitem-update",record:e,listeners:{success:{fn:this.refreshStore,scope:this}}}),this.CmpItemWindow.setValues(e),this.CmpItemWindow.show(t.target)},removeRecord:function(e){e.event&&e.node&&(e=e.record.json),MODx.msg.confirm({title:_("media.cmpitem_remove"),text:_("media.cmpitem_remove_confirm"),url:Media.config.connector_url,params:{action:"cmpitem/remove",id:e.id},listeners:{success:{fn:this.refreshStore,scope:this}}})},refreshStore:function(){this.store.reload()}};return r}),define("browser/List",["text!tpl/list.html","browser/Store","browser/shared"],function(e,t,n){return Media.ListView=function(n){n=n||{},Ext.applyIf(n,{store:t,itemSelector:"dl.record",hideHeaders:!0,plugins:["upload"],tpl:new Ext.XTemplate(e),columns:[{header:"",tpl:'<input type="checkbox" class="selector" <tpl if="selected">checked</tpl> />',width:.03},{header:_("media.name"),dataIndex:"name",width:.47},{header:_("media.description"),dataIndex:"description",sortable:!1,width:.47},{header:"",tpl:'<div class="grid-menu"><a class="listActions menu"><i class="menu icon icon-gear"></i>&nbsp;<i class="menu icon icon-angle-down"></i></a></div>',width:.03}],listeners:{click:this.onClickTest,dblclick:this.navigateTo}}),Media.ListView.superclass.constructor.call(this,n),this.store.on("load",function(e,t,n){var r=this.getSelectedIndexes();r.length>0&&this.selected.clear()},this)},Ext.extend(Media.ListView,Ext.list.ListView,Ext.applyIf({showMenu:function(e,t,n,r){r.stopEvent(),r.preventDefault();var i=r.getTarget("","",!0);i.hasClass("grid-menu")||(i=i.findParent(".grid-menu",5,!0));if(i.hasClass("active"))return this.hideMenu(i);i.addClass("active");var s=new Ext.menu.Menu({defaultAlign:"tl-b?",enableScrolling:!1,floating:!1,renderTo:i});s.on("itemclick",function(e){s.destroy(),i.removeClass("active")}),i.on("mouseleave",function(e,t){i.hasClass("active")&&this.hideMenu(i)},this),s.add({text:"Edit",handler:function(e,t){var r=this.getRecord(n).json;this.updateRecord(r,t)},scope:this}),s.add({text:"Remove",handler:function(e,t){var r=this.getRecord(n).json;this.removeRecord(r)},scope:this})},hideMenu:function(e){var t=e.child(".x-menu"),n=Ext.getCmp(t.id);n.destroy(),e.removeClass("active")},onClickTest:function(e,t,n,r){var i=this.getRecord(n),s=r.getTarget("","",!0);return s.is("input.selector")?this.toggleSelection(t):s.hasClass("preview")||s.up(".preview")||s.is('input[type="checkbox"]')?!1:s.is("a.menu")||s.is("i.menu")&&s.parent().hasClass("menu")?(console.log("icon!"),this.showMenu(e,t,n,r)):this.displayPreview(n,r)},previewToDOM:function(e,t){var n=Ext.get(e),r=n.down("div.x-clear");Ext.DomHelper.insertBefore(r,t,!0);var i=n.down("div.preview");this.animatePreview(i)}},n)),Ext.reg("media-list",Media.ListView),Media.ListView}),define("text!tpl/data.html",[],function(){return'<tpl for=".">{[this.bootstrap(xindex, xcount, values)]}\r\n    <li class="record {[this.getClass(xindex)]}">\r\n        <a href="javascript:;">\r\n            <img src="{thumb}" />\r\n            <span>{name}</span>\r\n        </a>\r\n\r\n        <div class="inline-actions x-hidden">\r\n            <ul>\r\n                <li>\r\n                    <a class="do selectRecord" href="javascript:;">\r\n                        <i class="icon icon-check"></i>\r\n                    </a>\r\n                </li>\r\n                <li>\r\n                    <a class="do updateRecord" href="javascript:;">\r\n                        <i class="icon icon-pencil"></i>\r\n                    </a>\r\n                </li>\r\n                <li>\r\n                    <a class="do displayPreview" href="javascript:;">\r\n                        <i class="icon icon-search"></i>\r\n                    </a>\r\n                </li>\r\n                <li>\r\n                    <a class="do removeRecord" href="javascript:;">\r\n                        <i class="icon icon-times"></i>\r\n                    </a>\r\n                </li>\r\n            </ul>\r\n        </div>\r\n    </li>\r\n</tpl>\r\n<div class="x-clear"></div>\r\n'}),define("browser/Data",["text!tpl/data.html","browser/Store","browser/shared"],function(e,t,n){return Media.DataView=function(e){e=e||{},Ext.applyIf(e,{store:t,itemSelector:"li.record",autoEl:{tag:"ul",cls:"data"},plugins:["upload"],tpl:this.getTemplate(),trackOver:!0,listeners:{click:this.onClickTest,mouseenter:this.displayMenu,mouseleave:this.maskMenu,dblclick:this.navigateTo}}),Media.DataView.superclass.constructor.call(this,e),this.on("removed",function(){this.cleanResizeListeners()},this),this.on("render",function(){Ext.getCmp("modx-content").on("resize",this.onResize,this)},this),this.store.on("load",function(e,t,n){var r=this.getSelectedIndexes();r.length>0&&this.selected.clear()},this)},Ext.extend(Media.DataView,Ext.DataView,Ext.applyIf({getTemplate:function(){var t=this,n={compiled:!0,disableFormats:!0,bootstrap:function(e,t,n){this.setActionsListeners(n)},getClass:function(e){var t="even";return e%2!==0&&(t="odd"),t},setActionsListeners:function(e){Ext.defer(function(){var n=t.store.find("id",e.id),r=t.store.getAt(n),i=t.getNode(r),s=Ext.get(i),o=s.query(".inline-actions .do");Ext.each(o,function(e,s,o){var u=Ext.get(e),a=u.dom.className.split(" ");if(a.length!=2){console.error("unknown action",a);return}var f=a[1];u.on("click",function(e,t,s){if(!this[f]){console.error("action %s not found in scope %o",f,this);return}var o={node:i,record:r,index:n,event:e};console.info("Should be running action %s with params %o",f,o),this[f](o)},t)})},1)}};return new Ext.XTemplate(e,n)},cleanResizeListeners:function(){var e=Ext.getCmp("modx-content");if(e.hasListener("resize")){var t=e.events.resize.listeners;Ext.each(t,function(e,n){e&&e.scope&&e.scope instanceof Media.DataView&&t.splice(n,1)})}},onResize:function(){console.log("[Data#onResize]",this.el);var e=this.el.child(this.previewSelector);if(!e)return;Ext.defer(function(){e.setWidth(this.el.getWidth());var t=this.el.getX(),n=e.getX();n<t?e.setStyle("left","0"):n>t&&e.setStyle("left",this.getPreviewLeft(e))},100,this)},onClickTest:function(e,t,n,r){},getInlineActions:function(e){return Ext.get(e).down("div.inline-actions")},toggleMenu:function(e,t,n,r){this.getInlineActions(n).toggleClass("x-hidden")},displayMenu:function(e,t,n,r){this.getInlineActions(n).removeClass("x-hidden")},maskMenu:function(e,t,n,r){this.getInlineActions(n).addClass("x-hidden")},beforeShowPreview:function(){var e=this;Ext.each(this.el.query(this.previewSelector),function(t,n,r){Ext.get(t).parent(this.itemSelector).setHeight(e.originalSize),t.parentNode.removeChild(t)})},afterPreviewRendered:function(e,t){var n=this.el.child(this.previewSelector),r=n.parent(this.itemSelector);this.originalSize=r.getHeight();var i=this.originalSize+n.getHeight()-10;console.log("afterPreviewRendered size",i),r.animate({height:{to:i,from:this.originalSize}}),n.setWidth(this.el.getWidth()).setStyle("z-index","1").setStyle("left",this.getPreviewLeft(n))},selectRecord:function(e){var t=e.index;this.toggleSelection(t)},fadeAndDestroy:function(e){console.log("fadeAndDestroy size",this.originalSize);var t=e.parent(this.itemSelector);t.animate({height:{to:this.originalSize}}),e.animate({opacity:{to:0,from:1}},"",function(){e.remove()})},getPreviewLeft:function(e){var t=e.parent(this.itemSelector),n=t.getX(),r=this.el.getX(),i=r-n+"px";return i}},n)),Ext.reg("media-data",Media.DataView),Media.DataView}),define("browser/Navigation",["utils/version"],function(){return Media.Navigation=function(e){e=e||{},Ext.applyIf(e,{_treePrefix:"source-tree-",autoHeight:!0,defaults:{autoHeight:!0,border:!1}}),Media.Navigation.superclass.constructor.call(this,e),this.on("render",this.getSourceList,this)},Ext.extend(Media.Navigation,Ext.Container,{getSourceList:function(){MODx.Ajax.request({url:MODx.config.connectors_url+(MODx.isRevo(">=","2.3.0-dev")?"":"source/index.php"),params:{action:(MODx.isRevo(">=","2.3.0-dev")?"source/":"")+"getList"},listeners:{success:{fn:function(e){this.onSourceListReceived(e.results)},scope:this},failure:{fn:function(e){return e.total>0&&e.results!=undefined&&this.onSourceListReceived(e.results),!1},scope:this}}})},onSourceListReceived:function(e){for(var t=0;t<e.length;t++){var n=e[t],r=this.getComponent(this._treePrefix+n.id);if(!r)var i=this.loadTree(n);this.add(i),i=r=void 0}this.doLayout()},loadTree:function(e){return MODx.load({xtype:"modx-tree-directory",itemId:this._treePrefix+e.id,stateId:this._treePrefix+e.id,id:this._treePrefix+e.id,rootName:e.name,hideSourceCombo:!0,source:e.id,tbar:!1,tbarCfg:{hidden:!0},listeners:{click:this.listData,scope:this}})},listData:function(e,t){var n=e.id,r=this.store,i=e.getOwnerTree().source,s=r.lastOptions.params||{};if(s.dir&&s.dir==n&&s.source&&s.source==i)return;var o=Ext.apply({},r.lastOptions);o.params=Ext.apply(r.lastOptions.params||{},{dir:n,source:i}),r.load(o)}}),Ext.reg("media-manager-nav",Media.Navigation),Media.Navigation}),define("browser/View",["browser/List","browser/Data","browser/Store","browser/Navigation"],function(e,t,n){return Media.HomeView=function(e){e=e||{};var t=Ext.state.Manager.get("media-view","data");Ext.apply(e,{border:!1,baseCls:"modx-formpanel",cls:"container",layout:"anchor",anchor:"100%",defaults:{layout:"anchor"},items:[{html:"<h2>"+_("media.management")+"</h2>",border:!1,cls:"modx-page-header"},{xtype:"container",items:[{html:_("media.management_desc"),border:!1,bodyCssClass:"panel-desc"},{xtype:"panel",tbar:[{text:"Add files",handler:this.showDropZone,scope:this},{text:"Get selected",handler:this.countSelected,scope:this},"->",{text:'<i class="icon icon-th-list"></i>',handler:this.showListView,scope:this},{text:'<i class="icon icon-th-large"></i>',handler:this.showDataView,scope:this}],layout:"column",defaults:{border:!1},items:[{width:250,items:[{xtype:"media-manager-nav",store:n,border:!1}]},{items:[{xtype:"media-"+t,itemId:"browser-view",height:"100%",border:!1}],height:"100%",currentType:t,id:"content-wrapper",columnWidth:1}]}]}]}),Media.HomeView.superclass.constructor.call(this,e)},Ext.extend(Media.HomeView,Ext.Container,{showView:function(n){var r=this.getWrapper();if(r.currentType===n)return!1;var i=this.getView().getSelectedIndexes();console.log("selected",i),this.getView().destroy();var s;switch(n){case"list":r.currentType="list",s=new e;break;case"data":r.currentType="data",s=new t}Ext.state.Manager.set("media-view",r.currentType),r.add(s),r.doLayout(),i.length>0&&(console.log("previous selection found"),Ext.defer(function(){Ext.each(i,function(e){console.log("Restoring selection",e),s.select(e,!0)})},100))},countSelected:function(){console.log(this.getView().getSelectedIndexes())},showListView:function(){return this.showView("list")},showDataView:function(){return this.showView("data")},getWrapper:function(){return Ext.getCmp("content-wrapper")},getView:function(){return this.getWrapper().items.items[0]},showDropZone:function(){this.getView().getUploader().showDropZone()},createRecord:function(e,t){this.getView().createRecord(e,t)}}),Ext.reg("media-panel-home",Media.HomeView),Media.HomeView}),define("vendor/requirejs-domready/domReady",[],function(){function u(e){var t;for(t=0;t<e.length;t+=1)e[t](s)}function a(){var e=o;i&&e.length&&(o=[],u(e))}function f(){i||(i=!0,n&&clearInterval(n),a())}function c(e){return i?e(s):o.push(e),c}var e,t,n,r=typeof window!="undefined"&&window.document,i=!r,s=r?document:null,o=[];if(r){if(document.addEventListener)document.addEventListener("DOMContentLoaded",f,!1),window.addEventListener("load",f,!1);else if(window.attachEvent){window.attachEvent("onload",f),t=document.createElement("div");try{e=window.frameElement===null}catch(l){}t.doScroll&&e&&window.external&&(n=setInterval(function(){try{t.doScroll(),f()}catch(e){}},30))}document.readyState==="complete"&&f()}return c.version="2.0.1",c.load=function(e,t,n,r){r.isBuild?n(null):c(n)},c}),require.config({paths:{vendor:"../vendor",text:"../vendor/requirejs-text/text",tpl:"../tpl"}}),require(["browser/View","vendor/requirejs-domready/domReady!"],function(e,t){MODx.add("media-panel-home")}),define("app",function(){});